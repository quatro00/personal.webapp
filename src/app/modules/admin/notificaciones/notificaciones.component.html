<div class="flex w-full flex-auto flex-col">

  <div class="relative flex flex-0 flex-col border-b px-6 py-8 sm:flex-row sm:items-center sm:justify-between md:px-8">
    <!-- Loader -->
    @if (isLoading) {
    <div class="absolute inset-x-0 bottom-0">
      <mat-progress-bar [mode]="'indeterminate'"></mat-progress-bar>
    </div>
    }
    <!-- Title -->
    <div>
      <h2 class="text-3xl font-semibold leading-8 tracking-tight">
        Notificaciones
      </h2>
      <div class="text-secondary font-medium tracking-tight">
        Las notificaciones seran generadas sobre el último reporte de conceptos adjunto.
      </div>
    </div>
    <!-- Actions -->
    <div class="mt-6 flex flex-col sm:flex-row items-stretch sm:items-center gap-4">
      <!-- Select de Organización -->
      <mat-form-field class="fuse-mat-dense min-w-64 sm:mr-4" style="flex: 1;">
        <mat-label>Organización</mat-label>
        <mat-select [formControl]="organizacionControl">
          <mat-option [value]="'0'">Seleccione</mat-option>
          <mat-option *ngFor="let org of organizaciones" [value]="org.id">
            {{ org.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <!-- Botón de nuevo -->
      <button class="sm:ml-4" mat-flat-button color="primary" (click)="buscarNotificaciones()" [disabled]="isLoading">
        @if (!isLoading) {
        <span class="ml-2 mr-1">Buscar</span>
        }
        @if (isLoading) {
        <mat-progress-spinner [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
        }

      </button>
      <!-- Búsqueda -->
      <mat-form-field class="fuse-mat-dense fuse-mat-rounded min-w-64" [subscriptSizing]="'dynamic'">
        <mat-icon class="icon-size-5" matPrefix [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
        <input matInput [formControl]="searchInputControl" [autocomplete]="'off'" [placeholder]="'Buscar'" />
      </mat-form-field>
    </div>

    <!-- Tabla de Organizaciones -->
  </div>

  <div class="p-4">
    <div class="mx-auto flex w-full max-w-screen-xl flex-wrap p-3 ">
      <div class="mt-8 grid w-full grid-cols-1 gap-8 xl:grid-cols-1" style="margin-top: 0px !important;">
        <!-- Recent transactions table -->
        <div class="bg-card flex flex-auto flex-col overflow-hidden rounded-2xl shadow xl:col-span-2">
          <div class="overflow-auto">
            <table mat-table [dataSource]="dataSource" class="mat-elevation-z1 w-full min-w-[1000px]">

              <!-- Quincena -->
              <ng-container matColumnDef="quincena">
                <th mat-header-cell *matHeaderCellDef>Quincena</th>
                <td mat-cell *matCellDef="let row">{{ row.quincena }}</td>
              </ng-container>

              <!-- Matrícula -->
              <ng-container matColumnDef="matricula">
                <th mat-header-cell *matHeaderCellDef>Matrícula</th>
                <td mat-cell *matCellDef="let row">{{ row.matricula }}</td>
              </ng-container>

              <!-- Nombre -->
              <ng-container matColumnDef="nombre">
                <th mat-header-cell *matHeaderCellDef>Nombre</th>
                <td mat-cell *matCellDef="let row">{{ row.nombre }}</td>
              </ng-container>

              <!-- DETALLE (tabla anidada) -->
              <ng-container matColumnDef="detalle">
                <th mat-header-cell *matHeaderCellDef>Detalle</th>

                <td mat-cell *matCellDef="let row">
                  <table mat-table [dataSource]="row.detalle" class="w-full border border-gray-300">

                    <!-- Concepto -->
                    <ng-container matColumnDef="concepto">
                      <th mat-header-cell *matHeaderCellDef>Concepto</th>
                      <td mat-cell *matCellDef="let d">{{ d.concepto }}</td>
                    </ng-container>

                    <!-- IncEntrada -->
                    <ng-container matColumnDef="incEnt">
                      <th mat-header-cell *matHeaderCellDef>Entrada</th>
                      <td mat-cell *matCellDef="let d">{{ d.incEnt }}</td>
                    </ng-container>

                    <!-- IncSalida -->
                    <ng-container matColumnDef="incSal">
                      <th mat-header-cell *matHeaderCellDef>Salida</th>
                      <td mat-cell *matCellDef="let d">{{ d.incSal }}</td>
                    </ng-container>

                    <!-- Fecha -->
                    <ng-container matColumnDef="fecha">
                      <th mat-header-cell *matHeaderCellDef>Fecha</th>
                      <td mat-cell *matCellDef="let d">{{ d.fecha }}</td>
                    </ng-container>

                    <!-- Descripción -->
                    <ng-container matColumnDef="descripcion">
                      <th mat-header-cell *matHeaderCellDef>Descripción</th>
                      <td mat-cell *matCellDef="let d">{{ d.descripcion }}</td>
                    </ng-container>

                    <!-- Header / Rows -->
                    <tr mat-header-row *matHeaderRowDef="detalleColumnas"></tr>
                    <tr mat-row *matRowDef="let det; columns: detalleColumnas;"></tr>

                  </table>
                </td>
              </ng-container>

              <!-- HEADER / ROW -->
              <tr mat-header-row *matHeaderRowDef="columnas"></tr>
              <tr mat-row *matRowDef="let row; columns: columnas;"></tr>

            </table>
          </div>
          <div class="flex justify-end p-4">
            <button mat-flat-button color="primary" (click)="enviarCorreos()">
              Enviar notificaciones
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>